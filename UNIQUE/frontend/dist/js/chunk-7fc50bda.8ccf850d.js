(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7fc50bda"],{"0145d":function(e,t,a){"use strict";a("7e0a")},"7e0a":function(e,t,a){},cd98:function(e,t,a){"use strict";a.r(t);var c=a("7a23");const o=e=>(Object(c["pushScopeId"])("data-v-79a2ffbe"),e=e(),Object(c["popScopeId"])(),e),n={class:"page-wrap"},s={class:"header-section has-header-main bg-pattern-3"},r={class:"create-section section-space-b pt-4 pt-md-5 mt-md-4"},l={class:"d-flex SaleCreateSection"},i={class:"container d-flex justify-content-end"},d={class:"row justify-content-center align-self-start"},m=Object(c["createStaticVNode"])('<div class="col-lg-8" data-v-79a2ffbe><div class="section-head-sm" data-v-79a2ffbe><a href="/details/" class="btn-link fw-semibold" data-v-79a2ffbe><em class="ni ni-arrow-left" data-v-79a2ffbe></em> Back</a><h1 class="mt-2" data-v-79a2ffbe>List item for sale</h1></div></div>',1),b={class:"col-lg-8"},f={action:"#",class:"form-create mb-5 mb-lg-0"},p={class:"form-item mb-4"},h=o(()=>Object(c["createElementVNode"])("h5",{class:"mb-3"},"Price",-1)),u={class:"mb-4 d-flex"},j=o(()=>Object(c["createElementVNode"])("div",{class:"col-4 pe-1"},[Object(c["createElementVNode"])("select",{class:"form-select",disabled:"","aria-label":"Default select example"},[Object(c["createElementVNode"])("option",{selected:""},"₿ SSF"),Object(c["createElementVNode"])("option",{value:"1"},"ETH")])],-1)),O={class:"col"},N={class:"form-item mb-4"},g={class:"mb-4"},V=o(()=>Object(c["createElementVNode"])("label",{class:"mb-2 form-label"},"Duration",-1)),k={class:"container"},E={class:"card card-full",style:{"max-width":"500px",height:"auto"}},v=o(()=>Object(c["createElementVNode"])("div",{class:"card-image"},[Object(c["createElementVNode"])("img",{src:"https://images.pexels.com/photos/1328876/pexels-photo-1328876.jpeg?auto=compress&cs=tinysrgb&dpr=1&w=500g",class:"card-img-top",style:{height:"auto"},alt:"art image"})],-1)),D={class:"card-body p-4"},w={class:"card-title text-truncate mb-0"},y={class:"card-author my-3 d-flex align-items-center"},T=o(()=>Object(c["createElementVNode"])("span",{class:"me-1 card-author-by"},"By",-1)),S={class:"custom-tooltip-wrap"},I=["href"],C={class:"card-price-wrap d-flex align-items-center justify-content-sm-between mb-3"},x=o(()=>Object(c["createElementVNode"])("div",{class:"me-5 me-sm-2"},[Object(c["createElementVNode"])("span",{class:"card-price-title"},"Type"),Object(c["createElementVNode"])("h4",{class:"card-price-number"},"NFT")],-1)),A={class:"text-sm-end"},P=o(()=>Object(c["createElementVNode"])("span",{class:"card-price-title"},"Price",-1)),F={class:"card-price-number"},M={key:0,class:"modal fade",id:"saleCreateNftModal",tabindex:"-1","aria-hidden":"true"},B={class:"modal-dialog modal-dialog-centered"},R={class:"modal-content"},_=o(()=>Object(c["createElementVNode"])("div",{class:"modal-header"},[Object(c["createElementVNode"])("h4",{class:"modal-title"},"Confirm Your list"),Object(c["createElementVNode"])("button",{type:"button",class:"btn-close icon-btn","data-bs-dismiss":"modal","aria-label":"Close"},[Object(c["createElementVNode"])("em",{class:"ni ni-cross"})])],-1)),K={class:"modal-body"},U=o(()=>Object(c["createElementVNode"])("p",{class:"mb-3"},[Object(c["createTextVNode"])("Before list item for sale, Please "),Object(c["createElementVNode"])("strong",null,"input your Private Key"),Object(c["createElementVNode"])("br")],-1)),q={class:"mb-3"},H={class:"form-label"};function L(e,t,a,o,L,$){const z=Object(c["resolveComponent"])("HeaderMain"),G=Object(c["resolveComponent"])("Datepicker"),J=Object(c["resolveComponent"])("Footer");return Object(c["openBlock"])(),Object(c["createElementBlock"])("div",n,[Object(c["createElementVNode"])("header",s,[Object(c["createVNode"])(z)]),Object(c["createElementVNode"])("section",r,[Object(c["createElementVNode"])("div",l,[Object(c["createElementVNode"])("div",i,[Object(c["createElementVNode"])("div",d,[m,Object(c["createElementVNode"])("div",b,[Object(c["createElementVNode"])("form",f,[Object(c["createElementVNode"])("div",p,[h,Object(c["createElementVNode"])("div",u,[j,Object(c["createElementVNode"])("div",O,[Object(c["withDirectives"])(Object(c["createElementVNode"])("input",{type:"price",class:"form-control form-control-s1","onUpdate:modelValue":t[0]||(t[0]=e=>L.marketData.price=e),placeholder:"Amount"},null,512),[[c["vModelText"],L.marketData.price]])])])]),Object(c["createElementVNode"])("div",N,[Object(c["createElementVNode"])("div",g,[V,Object(c["createVNode"])(G,{modelValue:o.date,"onUpdate:modelValue":t[1]||(t[1]=e=>o.date=e),placeholder:"시작과 종료날짜를 모두 입력해주세요",range:""},null,8,["modelValue"])])]),Object(c["createElementVNode"])("button",{type:"button","data-bs-toggle":"modal","data-bs-target":"#saleCreateNftModal",onClick:t[2]||(t[2]=(...e)=>$.checkInputData&&$.checkInputData(...e)),class:"btn btn-dark d-block"},"Complete listing")])])])]),Object(c["createElementVNode"])("div",k,[Object(c["createElementVNode"])("div",E,[v,Object(c["createElementVNode"])("div",D,[Object(c["createElementVNode"])("h3",w,Object(c["toDisplayString"])(o.marketInfoData.nft.nftName),1),Object(c["createElementVNode"])("div",y,[T,Object(c["createElementVNode"])("div",S,[Object(c["createElementVNode"])("a",{class:"h4",href:"/profile/"+o.marketInfoData.nft.nftAuthorName},Object(c["toDisplayString"])(o.marketInfoData.nft.nftAuthorName),9,I)])]),Object(c["createElementVNode"])("div",C,[x,Object(c["createElementVNode"])("div",A,[P,Object(c["createElementVNode"])("h4",F,"₿ SSF "+Object(c["toDisplayString"])(this.marketData.price),1)])])])])])])]),Object(c["createVNode"])(J,{classname:"bg-black on-dark"}),this.date&&this.marketData.price?(Object(c["openBlock"])(),Object(c["createElementBlock"])("div",M,[Object(c["createElementVNode"])("div",B,[Object(c["createElementVNode"])("div",R,[_,Object(c["createElementVNode"])("div",K,[U,Object(c["createElementVNode"])("div",q,[Object(c["createElementVNode"])("label",H,Object(c["toDisplayString"])(L.SectionData.createNftModal.labelText),1),Object(c["withDirectives"])(Object(c["createElementVNode"])("input",{type:"text",class:"form-control form-control-s1","onUpdate:modelValue":t[3]||(t[3]=e=>L.authorPrivateKey=e),placeholder:"please typing your Private Key"},null,512),[[c["vModelText"],L.authorPrivateKey]])]),Object(c["createElementVNode"])("button",{class:"btn btn-dark d-block",onClick:t[4]||(t[4]=(...e)=>$.submitSaleCreateNFT&&$.submitSaleCreateNFT(...e)),"data-bs-target":"#saleCreateNftModal2","data-bs-toggle":"modal"},"Confirm")])])])])):Object(c["createCommentVNode"])("",!0)])}var $=a("6c02"),z=a("bc3a"),G=a.n(z),J=a("99e5"),X=a.n(J),Y=a("07a4"),Q=a("fe42"),W=a("acb3"),Z=a("c5fa"),ee=a("574c"),te=a("584d"),ae=a("5502");const ce="https://j6e205.p.ssafy.io",oe=Object({NODE_ENV:"production",VUE_APP_SERVER_URL:"https://j6e205.p.ssafy.io",BASE_URL:""}).GANACHE_SERVER_URL;W.abi;let ne="0x6c927304104cdaa5a8b3691e0ade8a3ded41a333",se=Z.abi,re=Z.networks["202112031219"].address,le=ee.abi,ie=ee.networks["202112031219"].address,de=(te.abi,new X.a(new X.a.providers.HttpProvider(oe)));var me={name:"SaleCreate",setup(){const e=Object(ae["e"])(),t=Object(c["computed"])(()=>e.state.authToken),a=Object(c["ref"])(""),o=Object($["c"])(),n=o.params.id;G()({method:"get",url:`${ce}/api/nft/detail/${n}`,headers:{Authorization:t}}).then(e=>{console.log(e.data),a.value=e.data}).catch(()=>{alert("There is no item in our Market.")});const s=Object(c["ref"])();return Object(c["onMounted"])(()=>{const e=new Date;new Date((new Date).setDate(e.getDate()+7));let t=new Date(+e+324e5).toISOString().replace("T"," ").replace(/\..*/,""),a=new Date(new Date(+e).setDate(e.getDate()+7)+324e5).toISOString().replace("T"," ").replace(/\..*/,"");s.value=[t,a]}),{store:e,marketInfoData:a,date:s}},data(){return{thisItemData:[],id:"",SectionData:Y["a"],authorPrivateKey:null,newtokenId:null,marketData:{nftSeq:"",marketContractAddress:null,price:"",startTime:"",endTime:""},createSaleCA:null}},methods:{checkInputData(){this.date.length<2||!this.marketData.price?(alert("Please Input information for sales registration"),this.date=Object(c["ref"])(),this.marketData.price=null):console.log("성공")},async submitSaleCreateNFT(){console.log(this.marketInfoData.nft.nftTokenId,"this.marketInfoData.nft.nftTokenI");const e=await Object(Q["a"])("0x"+this.authorPrivateKey),t=this.myAddress;if(e===t&&this.marketInfoData.nft.nftOwnerAddress==t){const e=await new de.eth.Contract(le,ie),a=this.date[0],c=this.date[1];console.log(a,"2"),console.log(c,"2"),console.log(Date.parse(a),Date.parse(c),"@");const o=await e.methods.createSale(this.marketInfoData.nft.nftTokenId,Number(this.marketData.price),Date.parse(a),Date.parse(c),ne,re);console.log(o,"saleFactoryContractResult");const n=await o.encodeABI(),s=await o.estimateGas({from:t}),r={from:t,to:ie,gas:s,data:n};console.log(r,"saleCreateRawTx");const l=await de.eth.accounts.privateKeyToAccount(this.authorPrivateKey),i=await l.signTransaction(r);if(console.log(i,"signedTx"),null==i)alert("TransactionSignFailedException");else{await de.eth.sendSignedTransaction(i.rawTransaction);const o=await e.methods.allSales().call();console.log(o,"saleItems");const n=await e.getPastEvents("NewSale",{filter:{_owner:t}});console.log(n,"findMySales");const s=n[n.length-1].returnValues[0];n[n.length-1].returnValues[1],n[n.length-1].returnValues[2];let r=await new de.eth.Contract(se,re);const d=await r.methods.approve(s,this.marketInfoData.nft.nftTokenId),m=await d.encodeABI();console.log(m,"NFTContractInstanceEncodeMethod");const b={from:t,to:re,gas:5e7,data:m};console.log(b,"saleCreateRawTx");const f=await l.signTransaction(b);if(console.log(f,"NFTsignedTX"),null==f)alert("The sign of Approbation for NFT is not completed");else{const e=await de.eth.sendSignedTransaction(f.rawTransaction);console.log(e);let t=r.methods.getApproved(this.marketInfoData.nft.nftTokenId).call();console.log(t,"4"),this.marketData.nftSeq=this.marketInfoData.nft.nftSeq,this.marketData.marketContractAddress=s,this.marketData.startTime=a,this.marketData.endTime=c,G()({method:"post",url:ce+"/api/market/register/",headers:{Authorization:this.authToken},data:{nftSeq:this.marketInfoData.nft.nftSeq,marketContractAddress:s,price:Number(this.marketData.price),startTime:a,endTime:c}}).then(e=>{console.log(e,"백엔드에 저~장"),this.$router.push({name:"ProductDetail",params:{id:this.marketInfoData.nft.nftSeq}})}).catch(()=>{alert("There is no item in our Market.")})}}}else alert("Are you owner of this item? If you are, Please, check your Private key"),this.authorPrivateKey=null,this.$router.go()}},computed:{...Object(ae["d"])(["myAddress"]),...Object(ae["d"])(["authToken"])},mounted(){}},be=(a("0145d"),a("6b0d")),fe=a.n(be);const pe=fe()(me,[["render",L],["__scopeId","data-v-79a2ffbe"]]);t["default"]=pe}}]);